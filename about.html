<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>About | Solasaki Comics</title>

<link rel="stylesheet" href="style.css" />
</head>

<body class="fade">

<!-- ‚≠ê SAME HEADER AS INDEX (mobile fixed) -->
<header>
  <div class="logoarea">
    <img src="assets/uploads/IMG_0079.jpeg" alt="logo">
    <h1>Solasaki Comics</h1>
  </div>

  <nav>
    <a href="index.html">Home</a>
    <a href="comics.html">Comics</a>
    <a href="writeups.html">Write-ups</a>
    <a class="active" href="#">About</a>
    <a href="contact.html">Contact</a>
  </nav>

  <button class="toggle-mode" onclick="toggleMode()">üåô</button>
</header>



<!-- ‚≠ê PAGE CONTENT -->
<div class="page slide-up">
  <h2>About</h2>

  <p>Hello! Welcome to the yellow world. I'm Surbhi ‚Äî creator of Solasaki Comics.
     I make simple comics inspired by my weird observations. You can also read my writeups if you have nothing better to do.</p>

  <h3>Draw something for the artist or for yourself!!</h3>


  <!-- ‚≠ê SKETCH AREA -->
  <div class="sketch-wrapper">
    <canvas id="drawCanvas"></canvas>

    <div class="sketch-controls">
      <button id="pencilBtn">‚úèÔ∏è Pencil</button>
      <button id="eraserBtn" class="tool-secondary">üßΩ Eraser</button>
      <button id="undoBtn" class="tool-secondary">‚Ü©Ô∏è Undo</button>
      <button id="clearBtn" class="tool-secondary">üßπ Clear</button>
      <button id="saveBtn">Save Doodle</button>

      <span id="saveMsg" style="font-size:14px;color:var(--muted);"></span>
    </div>
  </div>


  <!-- ‚≠ê DOODLES -->
  <h3 style="margin-top:28px">Visitors‚Äô doodles</h3>

  <div id="doodleGrid" class="doodle-wall"></div>

</div>



<footer>
  <p>¬© 2025 Solasaki Comics</p>
</footer>



<!-- ‚≠ê SCRIPT: Supabase + Drawing + Auto Delete -->
<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

/* ------------------------------
   SUPABASE SETUP
------------------------------- */
const supabase = createClient(
  "https://rgxtvwnfqglsxnmvkkus.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJneHR2d25mcWdsc3hubXZra3VzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ3NjEwNzksImV4cCI6MjA4MDMzNzA3OX0.twtdhIMF4xnaBQsird8CyEb3g3Kh8bI5REChohdyGwo"
);



/* ------------------------------
   CANVAS ENGINE THAT NEVER BREAKS
------------------------------- */

const canvas = document.getElementById("drawCanvas");
const ctx = canvas.getContext("2d");


function fixCanvas() {
  const ratio = window.devicePixelRatio || 1;
  const w = canvas.clientWidth;
  const h = canvas.clientHeight;

  canvas.width = w * ratio;
  canvas.height = h * ratio;

  ctx.scale(ratio, ratio);
  ctx.lineCap = "round";

  redraw();
}

fixCanvas();
window.addEventListener("resize", fixCanvas);


let drawing = false;
let erasing = false;
let strokes = [];
let currentStroke = [];


/* --- Get pointer position --- */
function getPos(e) {
  const rect = canvas.getBoundingClientRect();
  const t = e.touches ? e.touches[0] : e;
  return { x: t.clientX - rect.left, y: t.clientY - rect.top };
}


/* --- Start drawing --- */
function start(e) {
  e.preventDefault();
  drawing = true;
  currentStroke = [];

  const p = getPos(e);
  ctx.beginPath();
  ctx.moveTo(p.x, p.y);

  currentStroke.push({ ...p, erasing });
}


/* --- Move / draw --- */
function move(e) {
  if (!drawing) return;
  e.preventDefault();

  const p = getPos(e);

  ctx.lineWidth = erasing ? 18 : 3;
  ctx.strokeStyle = erasing ? "#fffdf7" : "#000";

  ctx.lineTo(p.x, p.y);
  ctx.stroke();

  ctx.beginPath();
  ctx.moveTo(p.x, p.y);

  currentStroke.push({ ...p, erasing });
}


/* --- Stop drawing --- */
function stop() {
  drawing = false;
  if (currentStroke.length > 0) strokes.push(currentStroke);
}


/* --- Attach pointer events --- */
canvas.addEventListener("pointerdown", start);
canvas.addEventListener("pointermove", move);
window.addEventListener("pointerup", stop);



/* ------------------------------
   REDRAW ALL STROKES
------------------------------- */
function redraw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  for (let s of strokes) {
    for (let i = 1; i < s.length; i++) {
      const a = s[i - 1];
      const b = s[i];

      ctx.lineWidth = a.erasing ? 18 : 3;
      ctx.strokeStyle = a.erasing ? "#fffdf7" : "#000";

      ctx.beginPath();
      ctx.moveTo(a.x, a.y);
      ctx.lineTo(b.x, b.y);
      ctx.stroke();
    }
  }
}



/* ------------------------------
   BUTTONS
------------------------------- */
pencilBtn.onclick = () => (erasing = false);
eraserBtn.onclick = () => (erasing = true);

undoBtn.onclick = () => {
  strokes.pop();
  redraw();
};

clearBtn.onclick = () => {
  strokes = [];
  redraw();
};



/* ------------------------------
   FUNNY SAVE MESSAGES
------------------------------- */
const msgs = [
  "That one is actually pretty!",
  "Artist appreciates this one ‚ù§Ô∏è",
  "Ahhh‚Ä¶ try better maybe?",
  "World has never seen such an artist (please never draw again).",
  "The moon criticises this doodle.",
  "This doodle has strong 'why though?' energy.",
  "Beautiful. No one will understand it, ever.",
  "This belongs in a museum. A very small one.",
  "Even Yellow criticizes this one."
];
const randomMsg = () => msgs[Math.floor(Math.random() * msgs.length)];



/* ------------------------------
   AUTO-DELETE IF > 50MB
------------------------------- */
async function enforceLimit() {
  const { data } = await supabase.storage.from("doodles").list("", {
    limit: 2000,
    sortBy: { column: "created_at", order: "asc" },
  });
  if (!data) return;

  let total = data.reduce((s, f) => s + (f.size || 0), 0);
  const LIMIT = 50 * 1024 * 1024;

  while (total > LIMIT && data.length) {
    const oldest = data.shift();
    await supabase.storage.from("doodles").remove([oldest.name]);
    total -= oldest.size || 0;
  }
}



/* ------------------------------
   SAVE DOODLE
------------------------------- */
saveBtn.onclick = async () => {
  saveMsg.textContent = "Saving‚Ä¶";

  await enforceLimit();

  canvas.toBlob(async (blob) => {
    const name = `doodle-${Date.now()}.png`;
    const { error } = await supabase.storage.from("doodles").upload(name, blob);

    if (error) {
      saveMsg.textContent = "Failed to save!";
    } else {
      saveMsg.textContent = randomMsg();
      loadDoodles();
    }
  });
};



/* ------------------------------
   LOAD DOODLES GRID
------------------------------- */
async function loadDoodles() {
  const { data } = await supabase.storage.from("doodles").list("", {
    limit: 200,
    sortBy: { column: "created_at", order: "desc" },
  });

  const grid = document.getElementById("doodleGrid");
  grid.innerHTML = "";

  (data || []).forEach((f) => {
    const url =
      `https://rgxtvwnfqglsxnmvkkus.supabase.co/storage/v1/object/public/doodles/${f.name}`;

    const wrap = document.createElement("div");
    wrap.className = "doodle-sticker";

    const img = document.createElement("img");
    img.src = url;

    wrap.appendChild(img);
    grid.appendChild(wrap);
  });
}

loadDoodles();
</script>



<!-- ‚≠ê DARK MODE -->
<script>
function toggleMode() {
  document.documentElement.classList.toggle("dark");
  localStorage.setItem("mode",
    document.documentElement.classList.contains("dark") ? "dark" : "light"
  );
}

if (localStorage.getItem("mode") === "dark") {
  document.documentElement.classList.add("dark");
}
</script>


</body>
</html>
